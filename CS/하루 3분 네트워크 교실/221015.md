# 라우팅

## 주소와 경로

### IP 주소와 MAC 주소

MAC 주소 : 같은 네트워크 내에서의 수신처

IP 주소 수신처의 컴퓨터

IP 주소가 데이터의 최종 수신처가 되고, MAC 주소가 그 다음에 정의되는 수신처가 되는 것이다

- 인터넷 작업에서 데이터는 복수의 네트워크를 경유해서 최종 수신 컴퓨터까지 돌달함
- 어디를 통해서 경유할지 알아야 함
- 예) 어떤 네트워크A 에서 네트워크B를 경유해서 네트워크C에 간다고 할 떄, A에서 나온 데이터그램은 B로 들어가고, 이어서 C로 가는데, B로 들어간 시점에서 C로 중계해 줄 어딘가의 장소로 가야 한다
  - MAC 주소로 '다음으로 보낼 장소'를 결정

- MAC 주소로 다음에 보낼 장소를 지정하고 거기에 도달하면 다시 MAC 주소로 다음에 보낼 장소를 지정하는 것을 반복해서 최종 수신처에 도달함
- 수신처가 될 MAC 주소는 계속 바뀜
- 그 컴퓨터에 도달하면 이어서 다음을 지정할 필요가 있음
- MAC 주소는 변경되는 것이고, 반면 IP 주소는 변경이 없다

예) 

송신처: X -> Y

- 수신처
  - 논리 주소 : AA
    - 수신처 A의 논리 주소인 AA
  - 물리 주소 : yy
    - 동일 네트워크 안에서 중계를 해주는 장치 yy

Y->Z

- 장치가 Y가 중계해서 송신할 경우

- 수신처
  - 논리 주소 : AA
    - 논리 주소는 변함없이 AA
  - 물리 주소 : zz
    - 다음 중계처인 zz
    - 중계처가 명확하게 된다

### 경로

최종 수신처까지의 경로

- MAC 주소로 '다음 수신처' 지정
- IP 주소로 '최종 수신처'를 지정

라우터라는 장치가 이 경로를 결정하는 역할

자신의 위치에서 수신처까지 가기 위해 다음에 어디로 보내야 할지 그것만 결정

- 송신처에서 수신처까지의 모든 길을 이해하고 있는 것은 아니다

홉 바이 홉(Hop-by-Hop)

- 이렇게 반복해서 다음 길을 제시해 가는 방식
- 라우터는 다음 수신처를 결정하고 이것이 연결되어 경로가 된다
- 라우팅에서 '홉'이란 라우터를 가리키는 용어

복수의 라우터가 '다음' 수신처를 가리키는 과정을 반복함으로써 전체의 '경로'가 만들어져 감

라우터가 네트워크 경계상에 배치

- 전송받은 데이터그램을 라우팅해서 다음 수신처를 결정

다음 수신처

- 기본적으로는 수신처에 가기 위한 다음 라우터
- 수신처가 그 라우터와 접한 네트워크 내에 있는 경우에는 수신처의 컴퓨터 자체가 다음 수신처가 된다

라우터가 없으면 다음 네트워크에 데이터그램을 보낼 수 없다

- 라우터가 라우팅함으로써 다른 네트워크에 대한 경로가 생김
- 이 경로가 없으면 다른 네트워크에 도달하지 못한다
- 같은 허브에 연결되어 있더라도 다른 네트워크에 소속되어 있는 다른 한 대의 컴퓨터에는 데이터그램이 전달되지 않음
- 라우터가 없으면 다른 네트워크에는 전송할 수 없다
  - 컴퓨터는 다른 네트워크에 수신처가 있는 경우에는 라우터로 송신한다
  - 같은 네트워크에 수신처가 있는 경우에는 수신처에 직접 송신한다

컴퓨터가 송신하는 규칙

- 다른 네트워크 수신이면 라우터(디폴트 게이트웨이)로 동일 네트워크 수신이면 직접 통신한다
  1. 라우터(디폴트 게이트웨이)가 설정되어 있는 경우
     - 동일 네트워크 수신이면 수신처에 직접 송신한다
     - 다른 네트워크 수신이면 디폴트 게이트웨이에 설정된 라우터로 송신한다
  2. 라우터(디폴트 게이트웨이)가 설정되어 있지 않은 경우
     - 동일 네트워크 수신이면 수신처에 직접 송신한다
     - 다른 네트워크 수신이면 송신 불가능이 된다

디폴트 게이트웨이(Default Gateway)

- 컴퓨터에 '라우터가 설정되어 있지 않다면' 다른 네트워크에 대한 데이터 전송 자체가 불가능

## 라우터

### 라우터란

라우터는 복수의 인터페이스를 가질 수 있다

- 어떤 네트워크에서 다른 네트워크에 데이터그램을 보내는 역할을 하고 네트워크와 네트워크의 경계상에 배치

- 복수의 인터페이스를 가지고 거기서 복수의 네트워크에 연결되어 있다

라우터의 각 인터페이스는 각각의 네트워크에 소속되어 있는 형태

- 라우터의 인터페이스에는 논리 주소인 IP 주소가 설정되어 있다
- 각각 다른IP 주소를 가진다
- 라우터는 단독이 아니라 복수의 네트워크에 소속되어 있다

#### 라우팅

데이터그램의 수신처 IP 주소를 근거로 다음에 송신하는 라우터를 결정

이것을 수행함으로써 경로가 결정됨

#### 라우터의 역할

네트워크 경계상에 배치되어 라우팅한다

복수의 네트워크까리 연결

- 복수의 네트워크
  - LAN으로 사용되는 이더넷
  - WAN으로 사용되는 회선
- 이렇게 다른 종류의 네트워크를 연결하는 것도 라우터의 역할

- 다른 종류의 네트워크 사이에서 데이터 중계를 한다

필터링

- 전송받은 데이터그램에 대해 조건을 붙어 그 데이터그램을 파기하는 처리

- 예) 대학교 컴퓨터 실습실의 네트워크에서는 학생들의 데이터가 저장되어 있는 사무실의 네트워크로는 데이터를 전송하지 못하게 함

### 라우터의 동작

#### 라우팅 테이블

- 최적 경로의 지도
- 라우터가 수신한 패킷이 수신처까지 도달하기 위한 최적의 경로가 그려져 있는 지도

- 이걸 보고 라우터는 수신처 네트워크까지의 경로를 결정
- 기재된 것
  - 수신처 네트워크까지의 거리
  - 다음에 도달하는 라우터
  - 그 라우터에 연결되어 있는 자신의 인터페이스
- 라우팅 테이블이야말로 라우터의 중요한 요소

라우팅 테이블에서 수신처 네트워크를 찾아내어 다음에 도달하는 라우터를 결정하고 인터페이스에서 송신한다

1. 호스트로부터 패킷을 수신받는다.
2. 수신처 IP주소로부터 수신처 네트워크를 결정한다.
3. 라우팅 테이블에서 다음 중계할 라우터, 송신할 인터페이스가 결정된다
4. 결정된 인터페이스로부터 패킷을 송신한다.

#### 최장일치의 룰

롱기스트 매치(Longest Match)

실제 데이터그램의 수신처 IP 주소로부터 라우팅 테이블의 수신처 네트워크 주소를 결정해서 다음 라우터랑 송신 인터페이스를 결정

수신처 IP 주소와 수신처 네트워크 주소를 비교할 때 사용하는 규칙이 최장 일치의 룰

IP 주소의 비트열과 네트워크 주소의 비트열을 앞에서부터 순서대로 비교해서 가장 많이 일치하는 것부터 선택한다

프리픽스 길이까지 일치한 것 중에서도 가장 프리픽스 길이가 긴 경로를 사용한다

## 디폴트 게이트웨이

### 브로드캐스트 도메인

브로드캐스트는 라우터를 넘어서 전송할 수 없다

- 네트워크를 나눔으로써 브로드캐스트가 송신되는 양이 감소

브로드캐스트 도메인(Broadcast Domain)

- 라우터가 네트워크를 나누기 때문에 브로드캐스트가 다른 네트워크에 송신되지 않도록 한다

충돌 도메인 : 스위치가 구분

브로드캐스트 도메인 : 라우터가 구분

허브는 어느 쪽에도 영향을 미치지 않는다.

브로드캐스트 도메인=네트워크라고 생각해도 문제는 없다

### ARP와 라우터

ARP가 브로드캐스트

- ARP가 브로드캐스트라는건 라우터가 ARP를 다른 네트워크에 전송하지 않는다는 의미
- ARP는 수신처가 도달하지 않음
- 다른 네트워크에 있는 컴퓨터에 MAC 주소를 알 수 없게 됨

디폴트 게이트웨이 : 컴퓨터가 다음에 보낼 라우터

- 라우터는 네트워크의 경계상에 있고 다른 네트워크에 데이터그램을 라우팅

- 디폴트 게이트웨이가 네트워크의 출입구

### 디폴트 게이트웨이

다른 네트워크로 데이터를 전송하고 싶은 호스트는 일단 디폴트 게이트웨이로 데이터를 보내서 다른 네트워크로 전송한다

- 컴퓨터가 최초로 데이터를 보내는 수신처는 디폴트 게이트웨이가 됨

컴퓨터는 다른 네트워크에 데이터를 송신할 때 디폴트 게이트웨이로 ARP를 수행한다

- IP 주소는 최종 수신처, MAC는 다음 수신처를 정한다
- 컴퓨터가 다른 네트워크에 데이터를 송신할 경우의 수신처는 반드시 디폴트 게이트웨이의 MAC 주소가 된다
  1. 다른 네트워크에 데이터를 보내는 경우, 호스트는 디폴트 게이트웨이로 ARP를 수행해서 디폴트 게이트웨이의 MAC 주소를 입수한다.
  2. 호스트는 수신처 MAC 주소를 디폴트 게이트웨이로, 수신처 IP 주소를 수신처 호스트로 해서 패킷을 보낸다
  3. 수신받은 디폴트 게이트웨이는 라우팅을 하고, 중계 라우터, 송신포트를 결정하여 다음에 수신받을 상대(중계 라우터 또는 수신처)에게 ARP를 수행한다
  4. ARP에 의해 입수한 MAC 주소를 수신처 MAC 주소로, 자기 자신의 MAC 주소를 송신처 MAC 주소로 갱신하여 송신한다. IP 주소는 변경되지 않는다.

ARP로 디폴트 게이트웨이의 MAC 주소를 얻을 수 있다

- 컴퓨터가 수신처를 결정하면 수신처가 동일 네트워크가 아닌지 조사
- 동일 네트워크라면 수신처 IP 주소 수신으로 ARP를 실행해서 그 컴퓨터의 MAC 주소를 입수
- 다른 네트워크가 수신처라면 디폴트 게이트웨이의 MAC 주소를 얻음
- 컴퓨터에는 디폴트 게이트웨이의 IP 주소를 미리 설정
  - 설정 방법은 수동이나 DHCP
  - DHCP는 IP 주소 이외에 서브넷 마스크도 배포하고 디폴트 게이트웨이도 배포한다
  - 디폴트 게이트웨이가 설정되어 있지 않았을 경우 컴퓨터는 다른 네트워크에 데이터를 송신할 수 없다