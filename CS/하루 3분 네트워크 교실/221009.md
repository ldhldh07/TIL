# IP 어드레싱

## 3계층의 역할과 개요

### 네트워크

#### 계층의 상하관계

상위 계층은 하위 계층을 생각하지 않는다

하위 계층은 상위 계층을 위해 일한다

#### 세그먼트

라우터와 라우터 간의 범위

2계층 : 세그먼트 내에서 송수신을 하는 것

3계층 : 네트워크 간에서의 데이터 송수신을 하는 것 

#### 네트워크 

세그먼트라는 말은 1계층과 2계층에서 사용하는 말이고 3계층에서는 이것과 같은 범위를 가리켜서 네트워크라고 한다

넒은 의미

- 무언가와 무언가가 그물망으로 연결되어서 무언가를 운반하는 것

좁은 의미

- 세그먼트랑 동의어
- 라우터와 라우터로 분배된 컴퓨터 그룹

### 인터넷 작업

네트워크 내의 인접기기끼리는 2계층에 의해 연결되어 있음

- 멀티액세스 네트워크 혹은 포인트 투 포인트 네트워크의 형태로 컴퓨터가 연결되어 있음
- 1계층에서 신호를 전달하고 2계층에서 그것을 제어함으로써 데이터를 송수신할 수 있는 상태가 되는 것

- 네트워크 내라면 2계층까지만으로도 데이터 송수신이 가능

2계층까지의 기능만으로는 큰 네트워크를 구성할 수가 없음

- 이더넷으로 허브나 스위치를 사용하면 어느 정도 규모는 만들 수 있지만, 여러 가지 걸림돌이 생김

- 허브를 사용한 경우
  - 송신측이 보낸 신호는 허브에 의해 연결되어 있는 모든 기기에 도달함
- 스위치를 사용한 경우
  - 브로드캐스트를 제어하지 않는다는 문제는 해결되지 않음
    - 브로드캐스트를 송신하면 브로드캐스트가 도달하는 범위의 모든 컴퓨터가 그것을 수신해서 자기와 관계가 있는지 없는지를 확인해야 함
    - 그만큼 컴퓨터의 처리가 증가함
    - 대수가 늘어나면 늘어날수록 브로드캐스트의 총 수도 늘어나 확인하는 처리가 많아짐

라우터를 넘어서는 브로드캐스트는 송신되지 않는다

- 1개의 큰 네트워크를 복수의 네트워크로 분할함으로써 브로드캐스트가 도달하는 범위를 제한할 수 있다
- 네트워크를 나누니까 브로드캐스트가 송신되는 양이 줄음

네트워큳와 네트워크 사이에서 어떻게 데이터를 송수신할지

인터넷 작업

- 네트워크 간에서의 데이터 송수신
- 인터넷이라고도 함
- 3계층은 인터넷 작업을 수행하는 것이 그 역할
- 인터넷 작업에 의해 떨어진 위치에 있는 컴퓨터끼리 데이터 통신이 가능



## 인터넷 프로토콜

### 3계층의 역할과 IP

#### 어드레싱

2계층 이더넷

- 어드레스로서 MAC 주소를 사용

3계층

-  MAC 주소를 사용하지 않음
- MAC 주소는 장소를 특정할 수 없는 주소이기 때문이다
  - 제조업체 번호와 제조업체가 붙인 번호로 구성

3계층을 위한 주소

- 2계층의 세그먼트 내에서의 데이터 송수신에서는 MAC 주소로도 충분
  - 컴퓨터의 수가 적음

- 3계층처럼 네트워크를 가로질러서 다른 네트워크에 네이터를 전송하게 되면 컴퓨터의 수도 많아짐
- 어디라는 정보가 필요함

2계층과 3계층에서 2개의 주소를 사용함

##### 논리 주소

물리 주소
- 2계층에서 사용하는 주소
- MAC 주소
- 위치 정보가 포함되어 있지 않음

논리 주소
- 위치 정보가 포함되어 있음
  - 위치정보 : 어디에 네트워크에 있는 어느 컴퓨터라는 정보의 조합으로 실현됨
- 형태
  - 주소
  - 전화번호
  - 우편번호

#### 라우팅

경로 선택, 수신처까지 어떤 경로로 갈 지를 결정

경유하는 네트워크를 결정하는 것

- 복수의 네트워크가 연결되어 있는 상태에서 전달

- 전달하고 싶은 수신처가 여러개의 네트워크를 경유해야 도달하는 곳에 있는 경우 어느 네트워크를 경유해서 갈지를 결정

- 예) 수신처가 X라고 하면 A라는 네트워크를 경우해서 다음에 B라는 네트워크를 지나고 이어서 C라는 네트워크를 경우해서 X까지 간다고 결정해둠

라우터: 라우팅을 행하는 기기

패킷 교환기가 수신처에 연결되어 있는 회선을 선택해서 거기로 패킷을 송신하는 것도 라우팅
- 회선 : 네트워크

각각의 라우터가 수신처에 연결되어 있는 네트워크를 선택해서 거기로 보내는 것

### 인터넷 프로토콜

#### IP(Internet Protocol)

어드레싱과 라우팅에 의해 인터넷 작업을 수행하기 위한 프로토콜

TCP/IP 프로토콜에서 반드시 IP를 사용함

인터넷 작업 프로토콜

##### IP 버전

`IP버전4(IP version4, IPv4)`

`IP버전6(IP version6, IPv6)`

현재 일반적으로 사용되고 있는 것은 옛 버전인 IPv4

두 버전 사이에는 호환성이 없음
- IPv4만 사용하는 컴퓨터에는 `IPv6`를 사용하는 컴퓨터와 데이터 송수신을 못한다

둘 다 사용할 수 있는 컴퓨터도 있음
- 최근의 OS

IPv6은 앞으로 보급될 버전인데 지금은 아직 구 버전인 `IPv4`쪽이 더 우세하다
- 버전을 변경하게 되면 인터넷의 모든 기기가 거기에 대응해야 해서 변경이 간단하지 않다

#### IP 데이터그램

데이터 즉, 3계층 PDU 에 IP헤더가 붙은 상태의 PDU

IP 헤더와 IP 데이터 그램의 캡슐화

##### IP헤더

송신처와 수신처의 IP 주소

IP주소
- 프로토콜에서 정해진 논리 주소
- IP에서는 IP주소를 통해 수신처와 송신처를 정함

`IP 헤더` 20바이트 + α(옵션) + `페이로드`(상위 4계층 PDU 등이 들어간다.) 0~8 키로바이트

|      |                   |      |                                        |
| ---- | ----------------- | ---- | -------------------------------------- |
| 1    | 버전              | 4    | IP의 버전                              |
| 2    | 헤더 길이         | 4    | IP 헤더의 길이                         |
| 3    | 서비스 타입       | 8    | 패킷의 우선도/중요도                   |
| 4    | 데이터 길이       | 16   | IP헤더와 페이로드를 합친 길이          |
| 5    | ID                | 16   | 데이터그램의 식별번호                  |
| 6    | 플래그            | 3    | 데이터그램을 분할했는지 아닌지 판별    |
| 7    | 플래그먼트 오프셋 | 13   | 분할한 경우 본래대로 되돌릴 때 사용    |
| 8    | TTL               | 8    | 패킷의 생존시간                        |
| 9    | 프로토콜          | 8    | 상위 프로토콜 지정                     |
| 10   | 헤더 체크섬       | 16   | IP 헤더의 에러 체크용 코드             |
| 11   | 송신처 IP 주소    | 32   | 송신처의 논리 주소                     |
| 12   | 수신처 IP 주소    | 32   | 수신처의 논리 주소                     |
| (13) | 옵션              | n    | 특별한 설정을 할 때 사용. 없어도 된다. |



