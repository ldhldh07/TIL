## 서브네팅

### 네트워크를 분할한다

서브넷이라고도 함

IP 주소는 계층형이며 커다란 네트워크 안에 작은 네트워크를 만들 수 있다

이렇게 분할된 작은 네트워크를 서브네트워크 또는 서브넷이라고 함

호스트 번호의 일부를 줄여서 서브넷 번호를 만든다

- 서브넷으로 분할할 때는 서브네트워크를 나타내는 번호인 서브넷 번호가 필요함

- IP 주소는 32비트로 고정되어 있어서 새롭게 서브넷 번호를 추가하는 것은 불가능
- 호스트 번호의 비트를 서브넷 번호와 호스트 번호로 분할

- 예) 172.16.0.0에서 호스트 번호 16비트를 서브넷 번호 6비트와 호스트 번호 10비트로 분할함

  - 서브네트워크 1번의 호스트 번호 1번 컴퓨터의 IP 주소: 172.16.4.1
  - 서브넷화전 : 172.16.4.1
  - 서브넷화후: 10101100 00010000 /000001/00 00000001
    - 네트워크 번호 : 10101100 00010000
    - 서브넷 번호: 000001
    - 호스트 번호: 00 00000001

  - 4번 서브넷의 1번 컴퓨터로 보이지만 아니다
    - 10진수 표기법과 헷갈려서 그런 것이고 IP 주소는 비트다

### 서브넷 마스크

호스트 번호는 그 네트워크 관리자가 결정

서브넷 번호 부분도 원래는 호스트 번호 부분에서 가져다 씀

ICANN과 상관없이 그 네트워크 관리자가 마음대로 정할 수 있음

서브넷은 그 네트워크의 내부에서만 유효하다

- 네트워크 외부에서는 네트워크A의 서브넷1이나 서브넷2나 같은 네트워크A에 있기 떄문에 일일이 내부까지 몰라도 됨
- 인천광역시가 4개의 구로 분할되어 있다 해도 외부에서 보면 같은 인천 광역시

서브네팅(Subnetting)

- 이렇게 서브넷화하는 것

예) 클래스C 네트워크

- 192.168.100.0

- 서브넷의 숫자를 크게 하면 각 서브넷의 호스트 수는 감소

- 서브넷 부분에 비트수를 뺏기니까 서브넷 마다의 호스트 수가 줄어든다

  | 제1옥텟  | 제2옥텟  | 제3옥텟  | 서브넷부분 | 호스트부분 | 서브넷의 최대 수 | 서브넷마다 호스트 수 |
  | -------- | -------- | -------- | ---------- | ---------- | ---------------- | -------------------- |
  | 11000000 | 10101000 | 01100100 | -          | 00000000   | 없음             | 254대                |
  | 11000000 | 10101000 | 01100100 | 0          | 0000000    | 2개              | 126대                |
  | 11000000 | 10101000 | 01100100 | 00         | 000000     | 4개              | 62대                 |
  | 11000000 | 10101000 | 01100100 | 000        | 00000      | 8개              | 30대                 |
  | 11000000 | 10101000 | 01100100 | 0000       | 0000       | 16개             | 14대                 |
  | 11000000 | 10101000 | 01100100 | 00000      | 000        | 32개             | 6대                  |
  | 11000000 | 10101000 | 01100100 | 000000     | 00         | 64개             | 2대                  |
  | 11000000 | 10101000 | 01100100 | 0000000    | 0          | 128개            | 0대                  |
  | 11000000 | 10101000 | 01100100 | 00000000   | -          | 256개            | 0대                  |

  - 서브넷이 10개 필요한 경우 : 서브넷 부분 4비트, 호스트 부분 4비트가 되기 떄문에 서브넷마다 최대 14대
  - 호스트가 각 서브넷에 50대가 있을 경우 : 서브넷 부분 2비트, 호스트 부분 6비트가 되기 떄문에 서브넷의 수는 최대 4대


컴퓨터가 어느 네트워크에 소속되어 있는지 알아야 함

- IP 주소의 어디까지인지가 네트워크 주소인지 모르면 그것이 자신과 동일한 네트워크인지 아니면 다른 네트워크인지 모르게 됨
- 클래스를 알면 어디까지가 네트워크 번호인지는 알 수 있지만, 어디까지가 서브넷 번호인지 모름

서브넷마스크(Subnetmask)

- 비트열과 IP 주소와 동시에 표기
- IP 주소 중에 어디까지가 서브넷 번호인지를 나타냄
- IP 주소오 ㅏ같은 342비트
- 네트워크 번호 · 서브넷 번호의 비트를 모드 1, 호스트 번호를 0으로 한것
- 서브넷마스크의 비트가 1인 부분이 네트워크 번호
- IP주소와 서브넷마스크는 반드시 세트로 기술
- 예) 11111111 11111111 11111100 00000000

## 클래스리스 어드레싱

### 클래스풀과 클래스리스

지금은 클래스풀 어드레싱은 사용되지 않음

- 인터넷 보급에 따라 IP주소를 필요로 하는 조직이 많아져서 클래스풀 어드레싱으로는 문제가 있음
  - 3개의 클래스 A·B·C라는 대략적인 구분밖에 없음
  - 그 구분에 딱 맞지 않으면 낭비가 많아짐
  - 사용되지 않는 IP 주소가 증가

그래서 클래스리스 어드레싱(Classless Addressing)

### 클래스리스 어드레싱

클래스라는 구분을 없앤 어드레싱

- 클래스에 따른 고정된 할당을 하지 않고 자유롭게 할당할 수 있게 됨

필요에 따른 비트 수로 정함

예) 네트워크 번호가 18비트 필요하고 그 번호를 '1010 0000 0000 0001 01'로 한다는 식으로 정함

필요한 IP주소로부터 정함

예) 네트워크 번호가 18비트라면 호스트 부분에 사용할 수 있는 것은 32-18로 14 비트, 약 16,000개가 사용할 수 있는 IP 주소가 됨

슈퍼넷

- 원래는 클래스에 의한 할당 클래스풀 어드레싱을 해왔기 때문에 그 클래스를 통합해서 1개로 하는 것도 가능함
- 클래스 C의 네트워크를 통합해서 1개의 네트워크로 운영한다
- 2000개의 주소가 필요한 네트워크
  - 클래스C에서는 주소가 부족하다
  - 클래스B에서는 주소가 너무 많다
  - 8개의 클래스C를 통합해서 2,048개의 IP 주소를 갖는 네트워크로 만든다
  - 21비트를 네트워크 번호로 한다
  - 192.168.32.0(네트워크 번호 21비트)인 2,048개의 IP 주소를 갖는 슈퍼넷
  - 호스트 번호로 11비트를 사용하면 000 000000000 ~ 111 11111111인 2,048개가 있다

문제점

- 클래스가 없기 때문에 어디까지가 네트워크 번호의 비트인지를 모름

프리픽스 길이(Prefix-Length)

- 네트워크 번호의 길이를 나타나는 값
- 이것을 IP부호랑 같이 씀

- 21비트를 네트워크 번호로 하고 11비트를 호스트 번호로했을때
- 192.168.32.0 / 21
  - 주소 뒤에 슬래시를 넣고 그 뒤에 네트워크 번호 비트수(프리픽스 길이)를 기술한다
- 서브넷마스크의 255.255.248.0과 거의 같은 의미
  - 1111 1111 1111 1111 1111 1000 0000 0000

## DHCP

### 송신처의 IP 주소와 MAC 주소

이더넷을 사용해서 IP데이터그램을 송수신하기 위해서 4개의 주소가 필요

- 수신처 MAC 주소
- 송신처 MAC 주소
  - 송신할 인터페이스의 MAC 주소
- 수신처 IP 주소
- 송신처 IP 주소
  - 송신할 인터페이스에 설정되어 있는 IP 주소 사요ㅕㅇ
    - 정적인 것
      - 수동으로 IP 주소를 설정
    - 동적인 것
      - DHCP(Danamic Host Configuration Protocol)
      - IP 주소가 자동으로 컴퓨터에 설정되는 방법

### DHCP

할당할 IP 주소를 관리하고, 실제로 할당 작업을 수행하는 서버(Server)하고 할당 받는 클라이언트(Client)로 이루어진다

#### DHCP 서버

- DHCP의 서버
- DHCP 서버 소프트웨어라는 전용 소프트웨어를 실행

#### DHCP 클라이언트

- DHCP의 클라이언트
- DHCP 클라이언트 소프트웨어를 실행

클라이언트가 IP 주소를 요청하면 서버가 그에 응해 IP 주소를 할당함

#### IP 주소 풀

- 사전에 관리자가 할당할 주소의 범위
- 이 범위 내의 주소를 호트스에게 할당해도 좋다고 관리자가 결정해줄 필요가 있음
- 예) 192.168.1.0/24라는 네트워크에 있는 호스트에게 주소를 할당
  - 192.168.1.1 ~ 192.168.1.254까지의 주소를 할당해도 좋다고 결정해둠

서버는 IP 주소 풀 중에서 요청한 클라이언트에게 각각 유일한 것이 되도록 주소를 할당

1. 클라이언트가 서버에거 IP 주소 취득요청
2. 서버가 IP 주소 풀에서 사용되고 있지 않은 주소를 선택함
3. 클라이언트에게 IP 주소 할당

관리자가 범위만 정해놓으면 나머지는 서버가 자동적으로 할당

네트워크 관리자는 사전에 IP 주소의 대여 기간을 결정해 놓을 필요가 있다

할당보다는 대여라는 표현이 적절

기간을 설정하는 이유

- 호스트가 이동하거나 고장 난 경우
- 서버는 IP 주소를 할당했기 때문에 IP 주소는 이미 사용되고 있다고 생각함

- 그 컴퓨터에 할당한  IP 주소는 더 이상 사용할 수 없게 됨
- 그래서 대여기간을 설정
- 클라이언트 측이 계속해서 사용하고 싶으면 기간 연장을 신청

#### DHCP 메시지

주소와 옵션 설정 등의 정보를 갖는다

| 이더넷 헤더 | IP 헤더 | UDP 헤더 | DHCP 메시지 |
| ----------- | ------- | -------- | ----------- |

| 옥텟 | 이름                     | 설명                                                         |
| ---- | ------------------------ | ------------------------------------------------------------ |
| 1    | 오퍼레이션 코드          | 클라이언트->서버···1, 서버->클라이언트···2                   |
| 4    | 클라리언트 IP 주소       | 현재의 클라이언트 주소(재 대여 시에만)                       |
| 4    | 할당 IP 주소             | 서버가 할당한 주소                                           |
| 3    | 서버 IP 주소             | 서버 주소                                                    |
| 16   | 클라이언트 하드웨어 주소 | 클라이언트의 MAC 주소                                        |
| 가변 | 옵션                     | 메시지타입과 클라이언트 설정(서브넷마스트 · 디폴트게이트웨이 · DNS 서버 주소 · 대여기간 등) |

DHCP는 IP 주소만이 아니라 다른 네트워크의 설정 정보도 보낼 수 있음

동적 호스트 설정 프로토콜이라고 불림

#### DHCP의 동작

DISCOVER, OFFER, REQUEST, ACK 4 종류의 메시지를 클라이언트와 서버 간에 브로드캐스트를 사용해서 주고받는다

1. 클라이언트는 DHCP DISCOVER 메시지를 브로드캐스트한다

2. DISCOVER를 받은 서버는 할당할 IP 주소를 풀에서 선택해서 그것을 클라이언트에게 브로드캐스트해서 통지한다. (DHCP OFFER)
3. 클라이언트는 OFFER에서 받은 IP 주소로 문제가 없으면 DHCP REQUEST를 서버에 브로드캐스트한다
4. REQUEST를 받은 서버는 문제가 없으면 AHCP ACK를 보낸다.
5. 그 때 서브넷마스크 등 옵션 설정도 ACK에 넣어서 보낸다

송수신은 브로드캐스트를 사용해서 전체 수신으로 보냄

- 컴퓨터가 기동한 시점에서는 클라이언트는 누구에게 메시지를 보내면 좋을지 모르기 때문
- 어느 네트워크에 소속되어 있는지를 모름
